# Repository Guidelines

## Project Structure & Modules
- backend/: FastAPI app (`backend/app`), settings (`config.py`), DB models/migrations (`backend/alembic`), tests (`backend/tests/{unit,integration,manual}`).
- frontend/: Next.js + TypeScript app (`frontend/src/{pages,components,styles}`), API routes under `src/pages/api`, tests in `src/__tests__`.
- config/: Runtime YAML (e.g., `config/config.yaml`). data/, media/, temp/: app state, downloaded media, and temp files. docs/: requirements and dev notes.

## Build, Test, and Development
- Docker dev stack: `docker compose -f docker-compose.dev.yml up` (frontend at http://localhost:3000, backend at http://localhost:8000).
- Backend (inside container or local venv):
  - Install: `pip install -r backend/requirements.txt`
  - Run API: `uvicorn backend.main:app --reload`
  - Tests + coverage: `pytest -q` (fails under 80% cov; HTML at `backend/htmlcov`).
  - Migrations: `alembic upgrade head` (from `backend/`).
- Frontend:
  - Install: `cd frontend && npm ci`
  - Dev server: `npm run dev`
  - Tests: `npm test` (Jest + jsdom). Lint: `npm run lint`.

## Coding Style & Naming
- Python: Black (line length 88) and isort (Black profile). Run: `black backend && isort backend`.
- TypeScript/JS: ESLint (`next/core-web-vitals`, `@typescript-eslint`, `prettier`) and Prettier (printWidth 80, single quotes). Run: `npm run lint && npx prettier -w .` in `frontend/`.
- Naming: snake_case for Python, camelCase for TS/JS; PascalCase for React components; migration files follow Alembic’s autogenerated pattern.

## Testing Guidelines
- Backend: Pytest structure `test_*.py` under `backend/tests`, integration tests hit FastAPI endpoints; keep coverage ≥ 80%.
- Frontend: Jest in `frontend/src/__tests__`; prefer React Testing Library; name tests `*.test.tsx`.

## Commit & Pull Requests
- Commits: Prefer Conventional Commits (`feat:`, `fix:`, `docs:`, `chore:`, `refactor:`). Include scope when helpful (`frontend:`/`backend:`) and reference story/issue.
- PRs: Clear description, linked issue/story, test evidence (coverage or screenshots for UI), and notes on migrations or config changes.

## Security & Configuration
- Do not commit secrets; use `backend/.env` (see `.env.example`).
- Mount `data/`, `config/`, `media/`, and `temp/` as volumes in Docker. Validate `config/config.yaml` locally before deploy.
